- name: Install software for sway desktop
  package:
    name:
    - sway
    - swayidle
    - dmenu
    - gnome-keyring
    - pavucontrol
    - dex
    - gammastep
    - wf-recorder
    - waybar
    - xdg-desktop-portal-wlr
    - wofi
    - qt5ct
    - nemo
    - foot
    - fprintd
    - qt6-wayland
    - blueman
    state: present
  tags:
    - install

- name: Install generic UI components
  package:
    name:
    - gvfs-smb
    - qt5-wayland
    - libgnome-keyring
    - ttf-dejavu
    - swaylock
    - wireplumber
    - otf-font-awesome
    - xorg-xwayland
  tags:
    - install
  when: ansible_os_family == "Archlinux"

- name: Install generic UI components
  package:
    name:
    - gvfs-backends
    - qtwayland5
    - ttf-bitstream-vera
    - xwayland
    - wlr-randr
    - grim
    - slurp
    - wf-recorder
    state: present
  tags:
    - install
  when: ansible_os_family == "Debian"

- name: Install software for sway desktop
  kewlfft.aur.aur:
    name:
    - wlr-randr
  become: yes
  become_user: aur_builder
  tags:
    - install
  when: ansible_os_family == "Archlinux"

- name: Create screenrecorder script
  copy:
    src: sway-screenrecord
    dest: /usr/local/bin/sway_screenrecord
    mode: '0666'
  tags:
    - config

- name: Configure waybar
  template:
    src: waybar/config.j2
    dest: /etc/xdg/waybar/config
    mode: "0744"
  tags:
    - config

- name: Start user managers
  systemd:
    name: 'user@{{ users[item].uid }}.service'
    state: started
  loop: "{{ desktop_users }}"
  tags:
    - config

- name: Configure sway
  template:
    src: config.j2
    dest: /etc/sway/config
    mode: "0744"
  tags:
    - config

- name: Session launcher
  template:
    src: sway.sh.j2
    dest: /usr/local/bin/sway-session
  tags:
    - config

- name: Session launcher
  template:
    src: custom-sway.desktop.j2
    dest: /usr/share/wayland-sessions/custom-sway.desktop
  tags:
    - config

- name: Create swaylock PAM config
  copy:
    src: pam/swaylock
    dest: /etc/pam.d/swaylock
    mode: '0644'
  tags:
    - config
